# ====================================
# 通用 Nginx 站点配置模板
# ====================================
# 适用于静态网站和 SPA 应用

server {
    listen 80;
    server_name localhost;
    
    # 网站根目录
    root /data;
    index index.html index.htm;

    # 字符集
    charset utf-8;

    # 访问日志（可选，关闭可提高性能）
    access_log off;
    # access_log /var/log/nginx/access.log main;

    # 错误日志
    error_log /var/log/nginx/error.log warn;

    # ====================================
    # 主要路由配置
    # ====================================

    # 默认路由 - 支持 SPA 应用（React, Vue, Angular 等）
    location / {
        try_files $uri $uri/ /index.html;
    }

    # ====================================
    # API 代理示例（根据需要启用）
    # ====================================

    # 示例 1: 代理到后端 API
    # location /api/ {
    #     proxy_pass http://backend-server:3000/;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    #     
    #     # WebSocket 支持（如需要）
    #     # proxy_http_version 1.1;
    #     # proxy_set_header Upgrade $http_upgrade;
    #     # proxy_set_header Connection "upgrade";
    # }

    # 示例 2: 多个 API 代理
    # location /api/v1/ {
    #     proxy_pass http://backend-v1:3000/;
    # }
    # 
    # location /api/v2/ {
    #     proxy_pass http://backend-v2:3000/;
    # }

    # ====================================
    # 静态资源缓存
    # ====================================

    # 图片文件缓存 30 天
    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # CSS 和 JavaScript 缓存 7 天
    location ~* \.(css|js)$ {
        expires 7d;
        add_header Cache-Control "public";
    }

    # 字体文件缓存 1 年
    location ~* \.(woff|woff2|ttf|otf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 其他媒体文件
    location ~* \.(mp4|mp3|webm|ogg|pdf)$ {
        expires 30d;
        add_header Cache-Control "public";
    }

    # ====================================
    # 安全配置
    # ====================================

    # 禁止访问隐藏文件
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }

    # 禁止访问备份文件
    location ~ ~$ {
        deny all;
        access_log off;
        log_not_found off;
    }

    # ====================================
    # 其他配置
    # ====================================

    # 支持 Let's Encrypt 证书验证
    location ~ /.well-known {
        allow all;
    }

    # favicon.ico 和 robots.txt 不记录日志
    location = /favicon.ico {
        log_not_found off;
        access_log off;
    }

    location = /robots.txt {
        log_not_found off;
        access_log off;
    }

    # 自定义错误页面（可选）
    # error_page 404 /404.html;
    # error_page 500 502 503 504 /50x.html;
    # location = /50x.html {
    #     root /usr/share/nginx/html;
    # }
}

# ====================================
# HTTPS 配置示例（需要 SSL 证书）
# ====================================

# server {
#     listen 443 ssl http2;
#     server_name example.com;
#     
#     root /data;
#     index index.html;
#     
#     # SSL 证书配置
#     ssl_certificate /etc/nginx/ssl/cert.pem;
#     ssl_certificate_key /etc/nginx/ssl/key.pem;
#     
#     # SSL 优化配置
#     ssl_session_cache shared:SSL:10m;
#     ssl_session_timeout 10m;
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#     ssl_prefer_server_ciphers on;
#     
#     # 其他配置同上...
#     location / {
#         try_files $uri $uri/ /index.html;
#     }
# }

# HTTP 重定向到 HTTPS
# server {
#     listen 80;
#     server_name example.com;
#     return 301 https://$server_name$request_uri;
# }
